/**
 * スペシャルカード定義（英単語カード）
 * 各カードが英単語を持ち、盤面でその単語を完成させると効果が発動する。
 * レアリティが高いほど長い単語（N:3-4文字, R:4-5文字, SR:5-6文字, SSR:7文字以上）
 */

import type { SpecialCardDef } from "../game/types";

/** 絵文字のコードポイントから Twemoji CDN の SVG URL を生成 */
export function emojiToImageUrl(emoji: string | undefined): string {
  if (!emoji) return "";
  const cp = emoji.codePointAt(0);
  if (!cp) return "";
  return `https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/${cp.toString(16)}.svg`;
}

/** カードIDからアイコンを取得（localStorage復元用） */
export function getIconById(id: string): string {
  return SPECIAL_CARD_DEFS.find((c) => c.id === id)?.icon ?? "";
}

export const SPECIAL_CARD_DEFS: SpecialCardDef[] = [
  // ========== N レアリティ (60%) — 3〜4文字 ==========
  // Animals
  {
    id: "n_animal_cat",
    word: "CAT",
    meaning: "ねこ",
    description: "その単語 +5点",
    rarity: "N",
    categories: ["animals"],
    effectType: "bonus_flat",
    effectValue: 5,
    icon: "\u{1F431}",
  },
  {
    id: "n_animal_fox",
    word: "FOX",
    meaning: "きつね",
    description: "ノーマルカード1枚追加ドロー",
    rarity: "N",
    categories: ["animals"],
    effectType: "draw_normal",
    effectValue: 1,
    icon: "\u{1F98A}",
  },
  {
    id: "n_animal_owl",
    word: "OWL",
    meaning: "ふくろう",
    description: "フリーカード1枚回復",
    rarity: "N",
    categories: ["animals"],
    effectType: "recover_free",
    effectValue: 1,
    icon: "\u{1F989}",
  },
  // Food
  {
    id: "n_food_pie",
    word: "PIE",
    meaning: "パイ",
    description: "その単語 +5点",
    rarity: "N",
    categories: ["food"],
    effectType: "bonus_flat",
    effectValue: 5,
    icon: "\u{1F967}",
  },
  {
    id: "n_food_jam",
    word: "JAM",
    meaning: "ジャム",
    description: "ノーマルカード1枚追加ドロー",
    rarity: "N",
    categories: ["food"],
    effectType: "draw_normal",
    effectValue: 1,
    icon: "\u{1F36F}",
  },
  {
    id: "n_food_nut",
    word: "NUT",
    meaning: "ナッツ",
    description: "フリーカード1枚回復",
    rarity: "N",
    categories: ["food"],
    effectType: "recover_free",
    effectValue: 1,
    icon: "\u{1F95C}",
  },
  // Jobs
  {
    id: "n_jobs_spy",
    word: "SPY",
    meaning: "スパイ",
    description: "その単語 +5点",
    rarity: "N",
    categories: ["jobs"],
    effectType: "bonus_flat",
    effectValue: 5,
    icon: "\u{1F575}",
  },
  {
    id: "n_jobs_chef",
    word: "CHEF",
    meaning: "シェフ",
    description: "ノーマルカード1枚追加ドロー",
    rarity: "N",
    categories: ["jobs"],
    effectType: "draw_normal",
    effectValue: 1,
    icon: "\u{1F52A}",
  },
  {
    id: "n_jobs_cook",
    word: "COOK",
    meaning: "料理人",
    description: "フリーカード1枚回復",
    rarity: "N",
    categories: ["jobs"],
    effectType: "recover_free",
    effectValue: 1,
    icon: "\u{1F373}",
  },
  // Play
  {
    id: "n_hobby_ball",
    word: "BALL",
    meaning: "ボール",
    description: "その単語 +5点",
    rarity: "N",
    categories: ["hobby"],
    effectType: "bonus_flat",
    effectValue: 5,
    icon: "\u{26BD}",
  },
  {
    id: "n_hobby_goal",
    word: "GOAL",
    meaning: "ゴール",
    description: "ノーマルカード1枚追加ドロー",
    rarity: "N",
    categories: ["hobby"],
    effectType: "draw_normal",
    effectValue: 1,
    icon: "\u{1F3C0}",
  },
  {
    id: "n_hobby_dice",
    word: "DICE",
    meaning: "サイコロ",
    description: "フリーカード1枚回復",
    rarity: "N",
    categories: ["hobby"],
    effectType: "recover_free",
    effectValue: 1,
    icon: "\u{1F3B2}",
  },
  // All
  {
    id: "n_all_bee",
    word: "BEE",
    meaning: "ハチ",
    description: "その単語 +5点",
    rarity: "N",
    categories: ["animals", "all"],
    effectType: "bonus_flat",
    effectValue: 5,
    icon: "\u{1F41D}",
  },
  {
    id: "n_all_rice",
    word: "RICE",
    meaning: "こめ",
    description: "ノーマルカード1枚追加ドロー",
    rarity: "N",
    categories: ["food", "all"],
    effectType: "draw_normal",
    effectValue: 1,
    icon: "\u{1F35A}",
  },

  // ========== R レアリティ (25%) — 4〜5文字 ==========
  // Animals
  {
    id: "r_animal_crane",
    word: "CRANE",
    meaning: "つる",
    description: "そのターン合計 ×1.5",
    rarity: "R",
    categories: ["animals"],
    effectType: "word_multiplier",
    effectValue: 1.5,
    icon: "\u{1F426}",
  },
  {
    id: "r_animal_shark",
    word: "SHARK",
    meaning: "サメ",
    description: "ノーマル2枚ドロー",
    rarity: "R",
    categories: ["animals"],
    effectType: "draw_normal",
    effectValue: 2,
    icon: "\u{1F988}",
  },
  // Food
  {
    id: "r_food_bread",
    word: "BREAD",
    meaning: "パン",
    description: "そのターン合計 ×1.5",
    rarity: "R",
    categories: ["food"],
    effectType: "word_multiplier",
    effectValue: 1.5,
    icon: "\u{1F35E}",
  },
  {
    id: "r_food_grape",
    word: "GRAPE",
    meaning: "ぶどう",
    description: "ノーマル2枚ドロー",
    rarity: "R",
    categories: ["food"],
    effectType: "draw_normal",
    effectValue: 2,
    icon: "\u{1F347}",
  },
  // Jobs
  {
    id: "r_jobs_nurse",
    word: "NURSE",
    meaning: "看護師",
    description: "そのターン合計 ×1.5",
    rarity: "R",
    categories: ["jobs"],
    effectType: "word_multiplier",
    effectValue: 1.5,
    icon: "\u{1F489}",
  },
  {
    id: "r_jobs_judge",
    word: "JUDGE",
    meaning: "裁判官",
    description: "ノーマル2枚ドロー",
    rarity: "R",
    categories: ["jobs"],
    effectType: "draw_normal",
    effectValue: 2,
    icon: "\u{2696}",
  },
  // Play
  {
    id: "r_hobby_chess",
    word: "CHESS",
    meaning: "チェス",
    description: "そのターン合計 ×1.5",
    rarity: "R",
    categories: ["hobby"],
    effectType: "word_multiplier",
    effectValue: 1.5,
    icon: "\u{265F}",
  },
  {
    id: "r_hobby_poker",
    word: "POKER",
    meaning: "ポーカー",
    description: "ノーマル2枚ドロー",
    rarity: "R",
    categories: ["hobby"],
    effectType: "draw_normal",
    effectValue: 2,
    icon: "\u{1F0CF}",
  },
  // All
  {
    id: "r_all_tiger",
    word: "TIGER",
    meaning: "トラ",
    description: "そのターン合計 ×1.5",
    rarity: "R",
    categories: ["animals", "all"],
    effectType: "word_multiplier",
    effectValue: 1.5,
    icon: "\u{1F42F}",
  },

  // ========== SR レアリティ (10%) — 5〜6文字 ==========
  {
    id: "sr_animal_parrot",
    word: "PARROT",
    meaning: "おうむ",
    description: "そのターン +10点",
    rarity: "SR",
    categories: ["animals"],
    effectType: "bonus_flat",
    effectValue: 10,
    icon: "\u{1F99C}",
  },
  {
    id: "sr_food_cheese",
    word: "CHEESE",
    meaning: "チーズ",
    description: "そのターン +10点",
    rarity: "SR",
    categories: ["food"],
    effectType: "bonus_flat",
    effectValue: 10,
    icon: "\u{1F9C0}",
  },
  {
    id: "sr_jobs_doctor",
    word: "DOCTOR",
    meaning: "医者",
    description: "そのターン +10点",
    rarity: "SR",
    categories: ["jobs"],
    effectType: "bonus_flat",
    effectValue: 10,
    icon: "\u{1FA7A}",
  },
  {
    id: "sr_hobby_tennis",
    word: "TENNIS",
    meaning: "テニス",
    description: "そのターン +10点",
    rarity: "SR",
    categories: ["hobby"],
    effectType: "bonus_flat",
    effectValue: 10,
    icon: "\u{1F3BE}",
  },
  {
    id: "sr_all_falcon",
    word: "FALCON",
    meaning: "はやぶさ",
    description: "次ターンスコア ×1.5",
    rarity: "SR",
    categories: ["animals", "all"],
    effectType: "next_turn_mult",
    effectValue: 1.5,
    icon: "\u{1F985}",
  },
  {
    id: "sr_all_knight",
    word: "KNIGHT",
    meaning: "騎士",
    description: "ノーマル3枚ドロー",
    rarity: "SR",
    categories: ["jobs", "hobby", "all"],
    effectType: "draw_normal",
    effectValue: 3,
    icon: "\u{2694}",
  },

  // ========== SSR レアリティ (5%) — 7文字以上 ==========
  {
    id: "ssr_animal_dolphin",
    word: "DOLPHIN",
    meaning: "いるか",
    description: "そのターン スコア×2（加点上限 +40点）",
    rarity: "SSR",
    categories: ["animals"],
    effectType: "word_multiplier",
    effectValue: 2,
    icon: "\u{1F42C}",
  },
  {
    id: "ssr_food_pancake",
    word: "PANCAKE",
    meaning: "パンケーキ",
    description: "そのターン スコア×2（加点上限 +40点）",
    rarity: "SSR",
    categories: ["food"],
    effectType: "word_multiplier",
    effectValue: 2,
    icon: "\u{1F95E}",
  },
  {
    id: "ssr_jobs_captain",
    word: "CAPTAIN",
    meaning: "隊長",
    description: "そのターン スコア×2（加点上限 +40点）",
    rarity: "SSR",
    categories: ["jobs"],
    effectType: "word_multiplier",
    effectValue: 2,
    icon: "\u{2693}",
  },
  {
    id: "ssr_hobby_archery",
    word: "ARCHERY",
    meaning: "アーチェリー",
    description: "そのターン スコア×2（加点上限 +40点）",
    rarity: "SSR",
    categories: ["hobby"],
    effectType: "word_multiplier",
    effectValue: 2,
    icon: "\u{1F3F9}",
  },
  {
    id: "ssr_all_penguin",
    word: "PENGUIN",
    meaning: "ペンギン",
    description: "次ターンスコア ×2",
    rarity: "SSR",
    categories: ["animals", "all"],
    effectType: "next_turn_mult",
    effectValue: 2,
    icon: "\u{1F427}",
  },
  {
    id: "ssr_all_teacher",
    word: "TEACHER",
    meaning: "先生",
    description: "ノーマル3枚ドロー + フリーカード2枚回復",
    rarity: "SSR",
    categories: ["jobs", "all"],
    effectType: "draw_normal",
    effectValue: 3,
    icon: "\u{1F4DA}",
  },
];
