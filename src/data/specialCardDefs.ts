/**
 * スペシャルカード定義（英単語カード）
 * 各カードが英単語を持ち、盤面でその単語を完成させると効果が発動する。
 * レアリティが高いほど長い単語（N:3-4文字, R:4-5文字, SR:5-6文字, SSR:7文字以上）
 */

import type { SpecialCardDef } from "../game/types";

/** 絵文字のコードポイントから Twemoji CDN の SVG URL を生成 */
export function emojiToImageUrl(emoji: string | undefined): string {
  if (!emoji) return "";
  const cp = emoji.codePointAt(0);
  if (!cp) return "";
  return `https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/${cp.toString(16)}.svg`;
}

/** カードIDからアイコンを取得（localStorage復元用） */
export function getIconById(id: string): string {
  return SPECIAL_CARD_DEFS.find((c) => c.id === id)?.icon ?? "";
}

export const SPECIAL_CARD_DEFS: SpecialCardDef[] = [
  // ========== N レアリティ (60%) — 3〜4文字 ==========
  // Animals
  {
    id: "n_animal_cat",
    word: "CAT",
    meaning: "ねこ",
    description: "その単語 +5点",
    rarity: "N",
    categories: ["animals"],
    effectType: "bonus_flat",
    effectValue: 5,
    icon: "\u{1F431}",
  },
  {
    id: "n_animal_fox",
    word: "FOX",
    meaning: "きつね",
    description: "ノーマルカード1枚追加ドロー",
    rarity: "N",
    categories: ["animals"],
    effectType: "draw_normal",
    effectValue: 1,
    icon: "\u{1F98A}",
  },
  {
    id: "n_animal_owl",
    word: "OWL",
    meaning: "ふくろう",
    description: "フリーカード1枚回復",
    rarity: "N",
    categories: ["animals"],
    effectType: "recover_free",
    effectValue: 1,
    icon: "\u{1F989}",
  },
  // Food
  {
    id: "n_food_pie",
    word: "PIE",
    meaning: "パイ",
    description: "その単語 +5点",
    rarity: "N",
    categories: ["food"],
    effectType: "bonus_flat",
    effectValue: 5,
    icon: "\u{1F967}",
  },
  {
    id: "n_food_jam",
    word: "JAM",
    meaning: "ジャム",
    description: "ノーマルカード1枚追加ドロー",
    rarity: "N",
    categories: ["food"],
    effectType: "draw_normal",
    effectValue: 1,
    icon: "\u{1F36F}",
  },
  {
    id: "n_food_nut",
    word: "NUT",
    meaning: "ナッツ",
    description: "フリーカード1枚回復",
    rarity: "N",
    categories: ["food"],
    effectType: "recover_free",
    effectValue: 1,
    icon: "\u{1F95C}",
  },
  // Jobs
  {
    id: "n_jobs_spy",
    word: "SPY",
    meaning: "スパイ",
    description: "その単語 +5点",
    rarity: "N",
    categories: ["jobs"],
    effectType: "bonus_flat",
    effectValue: 5,
    icon: "\u{1F575}",
  },
  {
    id: "n_jobs_chef",
    word: "CHEF",
    meaning: "シェフ",
    description: "ノーマルカード1枚追加ドロー",
    rarity: "N",
    categories: ["jobs"],
    effectType: "draw_normal",
    effectValue: 1,
    icon: "\u{1F52A}",
  },
  {
    id: "n_jobs_cook",
    word: "COOK",
    meaning: "料理人",
    description: "フリーカード1枚回復",
    rarity: "N",
    categories: ["jobs"],
    effectType: "recover_free",
    effectValue: 1,
    icon: "\u{1F373}",
  },
  // Play
  {
    id: "n_hobby_ball",
    word: "BALL",
    meaning: "ボール",
    description: "その単語 +5点",
    rarity: "N",
    categories: ["hobby"],
    effectType: "bonus_flat",
    effectValue: 5,
    icon: "\u{26BD}",
  },
  {
    id: "n_hobby_goal",
    word: "GOAL",
    meaning: "ゴール",
    description: "ノーマルカード1枚追加ドロー",
    rarity: "N",
    categories: ["hobby"],
    effectType: "draw_normal",
    effectValue: 1,
    icon: "\u{1F3C0}",
  },
  {
    id: "n_hobby_dice",
    word: "DICE",
    meaning: "サイコロ",
    description: "フリーカード1枚回復",
    rarity: "N",
    categories: ["hobby"],
    effectType: "recover_free",
    effectValue: 1,
    icon: "\u{1F3B2}",
  },
  // All
  {
    id: "n_all_bee",
    word: "BEE",
    meaning: "ハチ",
    description: "その単語 +5点",
    rarity: "N",
    categories: ["animals", "all"],
    effectType: "bonus_flat",
    effectValue: 5,
    icon: "\u{1F41D}",
  },
  {
    id: "n_all_rice",
    word: "RICE",
    meaning: "こめ",
    description: "ノーマルカード1枚追加ドロー",
    rarity: "N",
    categories: ["food", "all"],
    effectType: "draw_normal",
    effectValue: 1,
    icon: "\u{1F35A}",
  },

  // ========== R レアリティ (25%) — 4〜5文字 ==========
  // Animals
  {
    id: "r_animal_crane",
    word: "CRANE",
    meaning: "つる",
    description: "そのターン合計 ×1.5",
    rarity: "R",
    categories: ["animals"],
    effectType: "word_multiplier",
    effectValue: 1.5,
    icon: "\u{1F426}",
  },
  {
    id: "r_animal_shark",
    word: "SHARK",
    meaning: "サメ",
    description: "ノーマル2枚ドロー",
    rarity: "R",
    categories: ["animals"],
    effectType: "draw_normal",
    effectValue: 2,
    icon: "\u{1F988}",
  },
  // Food
  {
    id: "r_food_bread",
    word: "BREAD",
    meaning: "パン",
    description: "そのターン合計 ×1.5",
    rarity: "R",
    categories: ["food"],
    effectType: "word_multiplier",
    effectValue: 1.5,
    icon: "\u{1F35E}",
  },
  {
    id: "r_food_grape",
    word: "GRAPE",
    meaning: "ぶどう",
    description: "ノーマル2枚ドロー",
    rarity: "R",
    categories: ["food"],
    effectType: "draw_normal",
    effectValue: 2,
    icon: "\u{1F347}",
  },
  // Jobs
  {
    id: "r_jobs_nurse",
    word: "NURSE",
    meaning: "看護師",
    description: "そのターン合計 ×1.5",
    rarity: "R",
    categories: ["jobs"],
    effectType: "word_multiplier",
    effectValue: 1.5,
    icon: "\u{1F489}",
  },
  {
    id: "r_jobs_judge",
    word: "JUDGE",
    meaning: "裁判官",
    description: "ノーマル2枚ドロー",
    rarity: "R",
    categories: ["jobs"],
    effectType: "draw_normal",
    effectValue: 2,
    icon: "\u{2696}",
  },
  // Play
  {
    id: "r_hobby_chess",
    word: "CHESS",
    meaning: "チェス",
    description: "そのターン合計 ×1.5",
    rarity: "R",
    categories: ["hobby"],
    effectType: "word_multiplier",
    effectValue: 1.5,
    icon: "\u{265F}",
  },
  {
    id: "r_hobby_poker",
    word: "POKER",
    meaning: "ポーカー",
    description: "ノーマル2枚ドロー",
    rarity: "R",
    categories: ["hobby"],
    effectType: "draw_normal",
    effectValue: 2,
    icon: "\u{1F0CF}",
  },
  // All
  {
    id: "r_all_tiger",
    word: "TIGER",
    meaning: "トラ",
    description: "そのターン合計 ×1.5",
    rarity: "R",
    categories: ["animals", "all"],
    effectType: "word_multiplier",
    effectValue: 1.5,
    icon: "\u{1F42F}",
  },

  // ========== SR レアリティ (10%) — 5〜6文字 ==========
  {
    id: "sr_animal_parrot",
    word: "PARROT",
    meaning: "おうむ",
    description: "そのターン +10点",
    rarity: "SR",
    categories: ["animals"],
    effectType: "bonus_flat",
    effectValue: 10,
    icon: "\u{1F99C}",
  },
  {
    id: "sr_food_cheese",
    word: "CHEESE",
    meaning: "チーズ",
    description: "そのターン +10点",
    rarity: "SR",
    categories: ["food"],
    effectType: "bonus_flat",
    effectValue: 10,
    icon: "\u{1F9C0}",
  },
  {
    id: "sr_jobs_doctor",
    word: "DOCTOR",
    meaning: "医者",
    description: "そのターン +10点",
    rarity: "SR",
    categories: ["jobs"],
    effectType: "bonus_flat",
    effectValue: 10,
    icon: "\u{1FA7A}",
  },
  {
    id: "sr_hobby_tennis",
    word: "TENNIS",
    meaning: "テニス",
    description: "そのターン +10点",
    rarity: "SR",
    categories: ["hobby"],
    effectType: "bonus_flat",
    effectValue: 10,
    icon: "\u{1F3BE}",
  },
  {
    id: "sr_all_falcon",
    word: "FALCON",
    meaning: "はやぶさ",
    description: "次ターンスコア ×1.5",
    rarity: "SR",
    categories: ["animals", "all"],
    effectType: "next_turn_mult",
    effectValue: 1.5,
    icon: "\u{1F985}",
  },
  {
    id: "sr_all_knight",
    word: "KNIGHT",
    meaning: "騎士",
    description: "ノーマル3枚ドロー",
    rarity: "SR",
    categories: ["jobs", "hobby", "all"],
    effectType: "draw_normal",
    effectValue: 3,
    icon: "\u{2694}",
  },

  // ========== SSR レアリティ (5%) — 7文字以上 ==========
  {
    id: "ssr_animal_dolphin",
    word: "DOLPHIN",
    meaning: "いるか",
    description: "そのターン スコア×2（加点上限 +40点）",
    rarity: "SSR",
    categories: ["animals"],
    effectType: "word_multiplier",
    effectValue: 2,
    icon: "\u{1F42C}",
  },
  {
    id: "ssr_food_pancake",
    word: "PANCAKE",
    meaning: "パンケーキ",
    description: "そのターン スコア×2（加点上限 +40点）",
    rarity: "SSR",
    categories: ["food"],
    effectType: "word_multiplier",
    effectValue: 2,
    icon: "\u{1F95E}",
  },
  {
    id: "ssr_jobs_captain",
    word: "CAPTAIN",
    meaning: "隊長",
    description: "そのターン スコア×2（加点上限 +40点）",
    rarity: "SSR",
    categories: ["jobs"],
    effectType: "word_multiplier",
    effectValue: 2,
    icon: "\u{2693}",
  },
  {
    id: "ssr_hobby_archery",
    word: "ARCHERY",
    meaning: "アーチェリー",
    description: "そのターン スコア×2（加点上限 +40点）",
    rarity: "SSR",
    categories: ["hobby"],
    effectType: "word_multiplier",
    effectValue: 2,
    icon: "\u{1F3F9}",
  },
  {
    id: "ssr_all_penguin",
    word: "PENGUIN",
    meaning: "ペンギン",
    description: "次ターンスコア ×2",
    rarity: "SSR",
    categories: ["animals", "all"],
    effectType: "next_turn_mult",
    effectValue: 2,
    icon: "\u{1F427}",
  },
  {
    id: "ssr_all_teacher",
    word: "TEACHER",
    meaning: "先生",
    description: "ノーマル3枚ドロー + フリーカード2枚回復",
    rarity: "SSR",
    categories: ["jobs", "all"],
    effectType: "draw_normal",
    effectValue: 3,
    icon: "\u{1F4DA}",
  },

  // ========== バトル専用カード ==========
  // --- reduce_opponent（相手スコア減少）---
  {
    id: "b_animal_wolf",
    word: "WOLF",
    meaning: "オオカミ",
    description: "相手のスコア -8",
    rarity: "R",
    categories: ["animals"],
    effectType: "reduce_opponent",
    effectValue: 8,
    icon: "\u{1F43A}",
    battleOnly: true,
  },
  {
    id: "b_food_spice",
    word: "SPICE",
    meaning: "スパイス",
    description: "相手のスコア -8",
    rarity: "R",
    categories: ["food"],
    effectType: "reduce_opponent",
    effectValue: 8,
    icon: "\u{1F336}",
    battleOnly: true,
  },
  {
    id: "b_jobs_thief",
    word: "THIEF",
    meaning: "泥棒",
    description: "相手のスコア -15",
    rarity: "SR",
    categories: ["jobs"],
    effectType: "reduce_opponent",
    effectValue: 15,
    icon: "\u{1F977}",
    battleOnly: true,
  },
  {
    id: "b_hobby_trick",
    word: "TRICK",
    meaning: "トリック",
    description: "相手のスコア -15",
    rarity: "SR",
    categories: ["hobby"],
    effectType: "reduce_opponent",
    effectValue: 15,
    icon: "\u{1F3AD}",
    battleOnly: true,
  },
  {
    id: "b_all_venom",
    word: "VENOM",
    meaning: "毒液",
    description: "相手のスコア -15",
    rarity: "SR",
    categories: ["animals", "all"],
    effectType: "reduce_opponent",
    effectValue: 15,
    icon: "\u{1F40D}",
    battleOnly: true,
  },
  {
    id: "b_all_thunder",
    word: "THUNDER",
    meaning: "雷",
    description: "相手のスコア -25",
    rarity: "SSR",
    categories: ["all"],
    effectType: "reduce_opponent",
    effectValue: 25,
    icon: "\u{26A1}",
    battleOnly: true,
  },

  // --- force_letter_count（相手タイル数制限）---
  {
    id: "b_animal_trap",
    word: "TRAP",
    meaning: "罠",
    description: "次ターン相手は2枚固定",
    rarity: "R",
    categories: ["animals"],
    effectType: "force_letter_count",
    effectValue: 2,
    icon: "\u{1FAA4}",
    battleOnly: true,
  },
  {
    id: "b_jobs_guard",
    word: "GUARD",
    meaning: "番人",
    description: "次ターン相手は2枚固定",
    rarity: "R",
    categories: ["jobs"],
    effectType: "force_letter_count",
    effectValue: 2,
    icon: "\u{1F6E1}",
    battleOnly: true,
  },
  {
    id: "b_food_frost",
    word: "FROST",
    meaning: "霜",
    description: "次ターン相手は1枚固定",
    rarity: "SR",
    categories: ["food"],
    effectType: "force_letter_count",
    effectValue: 1,
    icon: "\u{2744}",
    battleOnly: true,
  },
  {
    id: "b_hobby_block",
    word: "BLOCK",
    meaning: "ブロック",
    description: "次ターン相手は1枚固定",
    rarity: "SR",
    categories: ["hobby"],
    effectType: "force_letter_count",
    effectValue: 1,
    icon: "\u{1F9CA}",
    battleOnly: true,
  },
  {
    id: "b_all_freeze",
    word: "FREEZE",
    meaning: "凍結",
    description: "次ターン相手は1枚固定",
    rarity: "SSR",
    categories: ["animals", "all"],
    effectType: "force_letter_count",
    effectValue: 1,
    icon: "\u{1F976}",
    battleOnly: true,
  },

  // --- heal_hp（HP回復・バトル専用）---
  {
    id: "b_animal_lamb",
    word: "LAMB",
    meaning: "子羊",
    description: "HPを10回復",
    rarity: "N",
    categories: ["animals"],
    effectType: "heal_hp",
    effectValue: 10,
    icon: "\u{1F411}",
    battleOnly: true,
  },
  {
    id: "b_food_herb",
    word: "HERB",
    meaning: "ハーブ",
    description: "HPを10回復",
    rarity: "N",
    categories: ["food"],
    effectType: "heal_hp",
    effectValue: 10,
    icon: "\u{1F33F}",
    battleOnly: true,
  },
  {
    id: "b_jobs_medic",
    word: "MEDIC",
    meaning: "衛生兵",
    description: "HPを15回復",
    rarity: "R",
    categories: ["jobs"],
    effectType: "heal_hp",
    effectValue: 15,
    icon: "\u{1F3E5}",
    battleOnly: true,
  },
  {
    id: "b_hobby_relax",
    word: "RELAX",
    meaning: "リラックス",
    description: "HPを15回復",
    rarity: "R",
    categories: ["hobby"],
    effectType: "heal_hp",
    effectValue: 15,
    icon: "\u{1F6C0}",
    battleOnly: true,
  },
  {
    id: "b_food_honey",
    word: "HONEY",
    meaning: "はちみつ",
    description: "HPを20回復",
    rarity: "SR",
    categories: ["food"],
    effectType: "heal_hp",
    effectValue: 20,
    icon: "\u{1F36F}",
    battleOnly: true,
  },
  {
    id: "b_all_healing",
    word: "HEALING",
    meaning: "ヒーリング",
    description: "HPを30回復",
    rarity: "SSR",
    categories: ["all"],
    effectType: "heal_hp",
    effectValue: 30,
    icon: "\u{1F496}",
    battleOnly: true,
  },

  // ========== bonus_per_letter（置いた文字数×N点）==========
  {
    id: "n_animal_ant",
    word: "ANT",
    meaning: "アリ",
    description: "置いた文字数×2点",
    rarity: "N",
    categories: ["animals"],
    effectType: "bonus_per_letter",
    effectValue: 2,
    icon: "\u{1F41C}",
  },
  {
    id: "n_food_egg",
    word: "EGG",
    meaning: "たまご",
    description: "置いた文字数×2点",
    rarity: "N",
    categories: ["food"],
    effectType: "bonus_per_letter",
    effectValue: 2,
    icon: "\u{1F95A}",
  },
  {
    id: "r_hobby_rugby",
    word: "RUGBY",
    meaning: "ラグビー",
    description: "置いた文字数×3点",
    rarity: "R",
    categories: ["hobby"],
    effectType: "bonus_per_letter",
    effectValue: 3,
    icon: "\u{1F3C9}",
  },
  {
    id: "r_jobs_pilot",
    word: "PILOT",
    meaning: "パイロット",
    description: "置いた文字数×3点",
    rarity: "R",
    categories: ["jobs"],
    effectType: "bonus_per_letter",
    effectValue: 3,
    icon: "\u{2708}",
  },

  // ========== draw_special（スペシャルカード追加ドロー）==========
  {
    id: "r_food_melon",
    word: "MELON",
    meaning: "メロン",
    description: "スペシャルカード1枚ドロー",
    rarity: "R",
    categories: ["food"],
    effectType: "draw_special",
    effectValue: 1,
    icon: "\u{1F348}",
  },
  {
    id: "sr_hobby_castle",
    word: "CASTLE",
    meaning: "城",
    description: "スペシャルカード1枚ドロー",
    rarity: "SR",
    categories: ["hobby"],
    effectType: "draw_special",
    effectValue: 1,
    icon: "\u{1F3F0}",
  },
  {
    id: "ssr_animal_giraffe",
    word: "GIRAFFE",
    meaning: "キリン",
    description: "スペシャルカード2枚ドロー",
    rarity: "SSR",
    categories: ["animals"],
    effectType: "draw_special",
    effectValue: 2,
    icon: "\u{1F992}",
  },

  // ========== steal_points（相手スコア奪取・バトル専用）==========
  {
    id: "b_animal_snake",
    word: "SNAKE",
    meaning: "ヘビ",
    description: "相手から8点奪取",
    rarity: "R",
    categories: ["animals"],
    effectType: "steal_points",
    effectValue: 8,
    icon: "\u{1F40D}",
    battleOnly: true,
  },
  {
    id: "b_jobs_pirate",
    word: "PIRATE",
    meaning: "海賊",
    description: "相手から15点奪取",
    rarity: "SR",
    categories: ["jobs"],
    effectType: "steal_points",
    effectValue: 15,
    icon: "\u{1F3F4}",
    battleOnly: true,
  },
  {
    id: "b_all_scorpion",
    word: "SCORPION",
    meaning: "サソリ",
    description: "相手から25点奪取",
    rarity: "SSR",
    categories: ["animals", "all"],
    effectType: "steal_points",
    effectValue: 25,
    icon: "\u{1F982}",
    battleOnly: true,
  },

  // ========== shield（妨害無効化・バトル専用）==========
  {
    id: "b_jobs_armor",
    word: "ARMOR",
    meaning: "鎧",
    description: "1ターン妨害無効化",
    rarity: "R",
    categories: ["jobs"],
    effectType: "shield",
    effectValue: 1,
    icon: "\u{1F6E1}",
    battleOnly: true,
  },
  {
    id: "b_hobby_shrine",
    word: "SHRINE",
    meaning: "神社",
    description: "2ターン妨害無効化",
    rarity: "SR",
    categories: ["hobby"],
    effectType: "shield",
    effectValue: 2,
    icon: "\u{26E9}",
    battleOnly: true,
  },

  // ========== poison（継続ダメージ・バトル専用）==========
  {
    id: "b_food_mold",
    word: "MOLD",
    meaning: "カビ",
    description: "相手に毎ターン3ダメージ(3ターン)",
    rarity: "R",
    categories: ["food"],
    effectType: "poison",
    effectValue: 3,
    icon: "\u{1F9AB}",
    battleOnly: true,
  },
  {
    id: "b_animal_spider",
    word: "SPIDER",
    meaning: "クモ",
    description: "相手に毎ターン5ダメージ(3ターン)",
    rarity: "SR",
    categories: ["animals"],
    effectType: "poison",
    effectValue: 5,
    icon: "\u{1F577}",
    battleOnly: true,
  },
  {
    id: "b_all_chimera",
    word: "CHIMERA",
    meaning: "キメラ",
    description: "相手に毎ターン8ダメージ(3ターン)",
    rarity: "SSR",
    categories: ["all"],
    effectType: "poison",
    effectValue: 8,
    icon: "\u{1F432}",
    battleOnly: true,
  },

  // ========== mirror（相手効果コピー・バトル専用）==========
  {
    id: "b_hobby_mimic",
    word: "MIMIC",
    meaning: "ミミック",
    description: "1ターン相手の効果をコピー",
    rarity: "SR",
    categories: ["hobby"],
    effectType: "mirror",
    effectValue: 1,
    icon: "\u{1FA9E}",
    battleOnly: true,
  },
  {
    id: "b_all_phantom",
    word: "PHANTOM",
    meaning: "ファントム",
    description: "2ターン相手の効果をコピー",
    rarity: "SSR",
    categories: ["all"],
    effectType: "mirror",
    effectValue: 2,
    icon: "\u{1F47B}",
    battleOnly: true,
  },
];
